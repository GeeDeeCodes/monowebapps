<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WEBCLOCK — Time Utility</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0a0a0b;
    --surface: #111113;
    --surface2: #18181c;
    --border: #252529;
    --accent: #e8ff47;
    --accent2: #ff6b35;
    --accent3: #47b8ff;
    --text: #f0f0f0;
    --muted: #555560;
    --danger: #ff4040;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
    cursor: default;
  }

  /* Grain overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.4;
  }

  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 40px;
    border-bottom: 1px solid var(--border);
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 28px;
    letter-spacing: 6px;
    color: var(--accent);
  }

  .live-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
  }

  .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--accent);
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(0.8); }
  }

  nav {
    display: flex;
    gap: 0;
    padding: 0 40px;
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
  }

  .nav-btn {
    background: none;
    border: none;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 18px 24px;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .nav-btn:hover { color: var(--text); }
  .nav-btn.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }

  .panel {
    display: none;
    padding: 60px 40px;
    max-width: 900px;
    margin: 0 auto;
    animation: fadeIn 0.3s ease;
  }

  .panel.active { display: block; }

  /* Local system font stack (no external fonts) */
  :root {
    --local-sans: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    --local-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", monospace;
  }
  body { font-family: var(--local-sans); }
  pre, code, kbd, samp, .editable, .jrow, .node-content, .logo sub, .tog { font-family: var(--local-mono); }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* === CLOCK PANEL === */
  .clock-display {
    text-align: center;
    margin-bottom: 60px;
  }

  .big-time {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(100px, 22vw, 200px);
    line-height: 0.85;
    letter-spacing: -2px;
    color: var(--text);
    text-shadow: 0 0 80px rgba(232,255,71,0.15);
  }

  .big-time .colon {
    color: var(--accent);
    animation: blink 1s step-end infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.2; }
  }

  .time-meta {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 32px;
    margin-top: 16px;
  }

  .seconds-display {
    font-size: 48px;
    font-family: 'Bebas Neue', sans-serif;
    color: var(--accent);
    letter-spacing: 4px;
  }

  .ampm {
    font-size: 20px;
    font-family: 'Bebas Neue', sans-serif;
    color: var(--muted);
    letter-spacing: 3px;
  }

  .date-display {
    font-size: 13px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    margin-top: 12px;
  }

  /* Analog clock */
  .analog-container {
    display: flex;
    justify-content: center;
    margin: 20px 0 40px;
  }

  .analog-clock {
    width: 200px;
    height: 200px;
    border: 1px solid var(--border);
    border-radius: 50%;
    position: relative;
    background: var(--surface);
  }

  .analog-clock::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: var(--accent);
    border-radius: 50%;
    z-index: 10;
  }

  /* Hour markers */
  .tick {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 1px;
    background: var(--border);
    transform-origin: bottom center;
  }

  .hand {
    position: absolute;
    bottom: 50%;
    left: 50%;
    transform-origin: bottom center;
    border-radius: 2px;
    transition: transform 0.1s cubic-bezier(0.4, 2.08, 0.55, 0.44);
  }

  .hand-hour {
    width: 3px;
    height: 55px;
    margin-left: -1.5px;
    background: var(--text);
  }

  .hand-minute {
    width: 2px;
    height: 75px;
    margin-left: -1px;
    background: var(--text);
  }

  .hand-second {
    width: 1px;
    height: 85px;
    margin-left: -0.5px;
    background: var(--accent);
    transition: transform 0.1s ease;
  }

  /* === STOPWATCH === */
  .sw-display {
    text-align: center;
    margin-bottom: 50px;
  }

  .sw-time {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(72px, 16vw, 140px);
    letter-spacing: 4px;
    color: var(--text);
    line-height: 1;
  }

  .sw-ms {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 56px;
    color: var(--accent);
    letter-spacing: 4px;
  }

  .btn-row {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-bottom: 40px;
  }

  .btn {
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 14px 32px;
    border: 1px solid var(--border);
    background: none;
    color: var(--text);
    cursor: pointer;
    border-radius: 2px;
    transition: all 0.15s;
  }

  .btn:hover {
    background: var(--surface2);
    border-color: var(--accent);
    color: var(--accent);
  }

  .btn.primary {
    background: var(--accent);
    color: #000;
    border-color: var(--accent);
    font-weight: 500;
  }

  .btn.primary:hover {
    background: #f5ff80;
    color: #000;
  }

  .btn.danger {
    border-color: var(--danger);
    color: var(--danger);
  }

  .btn.danger:hover {
    background: var(--danger);
    color: #fff;
  }

  .laps-table {
    width: 100%;
    border-collapse: collapse;
  }

  .laps-table th {
    text-align: left;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
  }

  .laps-table td {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    font-size: 14px;
  }

  .laps-table tr:first-child td { color: var(--accent); }

  /* === TIMER === */
  .timer-setup {
    display: flex;
    justify-content: center;
    gap: 0;
    margin-bottom: 40px;
  }

  .time-unit {
    text-align: center;
  }

  .time-unit label {
    display: block;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
  }

  .time-unit input {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 80px;
    width: 120px;
    background: none;
    border: none;
    border-bottom: 1px solid var(--border);
    color: var(--text);
    text-align: center;
    outline: none;
    letter-spacing: 4px;
    -moz-appearance: textfield;
  }

  .time-unit input::-webkit-outer-spin-button,
  .time-unit input::-webkit-inner-spin-button { -webkit-appearance: none; }

  .time-unit input:focus { border-bottom-color: var(--accent); }

  .time-sep {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 80px;
    padding: 0 4px;
    color: var(--border);
    align-self: center;
    margin-top: 24px;
  }

  .timer-countdown {
    text-align: center;
    display: none;
    margin-bottom: 40px;
  }

  .timer-remaining {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(72px, 16vw, 140px);
    letter-spacing: 4px;
    color: var(--text);
    line-height: 1;
  }

  .timer-bar-wrap {
    width: 100%;
    max-width: 500px;
    margin: 24px auto;
    height: 2px;
    background: var(--border);
    border-radius: 1px;
  }

  .timer-bar {
    height: 100%;
    background: var(--accent);
    border-radius: 1px;
    transition: width 1s linear;
    width: 100%;
  }

  .timer-bar.urgent { background: var(--danger); }

  /* === ALARM === */
  .alarms-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 32px;
  }

  .alarm-item {
    display: flex;
    align-items: center;
    gap: 20px;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 20px 24px;
    border-radius: 4px;
  }

  .alarm-item.active-alarm {
    border-color: var(--accent);
    animation: alarmGlow 0.5s ease-in-out infinite alternate;
  }

  @keyframes alarmGlow {
    from { box-shadow: 0 0 0 rgba(232,255,71,0); }
    to { box-shadow: 0 0 20px rgba(232,255,71,0.3); }
  }

  .alarm-time-display {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 42px;
    letter-spacing: 3px;
    flex: 1;
  }

  .alarm-label {
    font-size: 12px;
    color: var(--muted);
    flex: 1;
  }

  .toggle {
    position: relative;
    width: 44px;
    height: 24px;
    flex-shrink: 0;
  }

  .toggle input { opacity: 0; width: 0; height: 0; }

  .toggle-track {
    position: absolute;
    inset: 0;
    background: var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .toggle-track::before {
    content: '';
    position: absolute;
    left: 3px;
    top: 3px;
    width: 18px;
    height: 18px;
    background: var(--muted);
    border-radius: 50%;
    transition: all 0.2s;
  }

  .toggle input:checked + .toggle-track { background: var(--accent); }
  .toggle input:checked + .toggle-track::before {
    transform: translateX(20px);
    background: #000;
  }

  .alarm-delete {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 18px;
    padding: 4px;
    transition: color 0.15s;
  }

  .alarm-delete:hover { color: var(--danger); }

  .add-alarm-form {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 12px;
    align-items: end;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 24px;
    border-radius: 4px;
  }

  .form-group label {
    display: block;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
  }

  .form-group input[type="time"],
  .form-group input[type="text"] {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 14px;
    padding: 12px 16px;
    border-radius: 2px;
    outline: none;
    transition: border-color 0.15s;
  }

  .form-group input:focus { border-color: var(--accent); }

  /* Color scheme for input[type=time] */
  input[type="time"]::-webkit-calendar-picker-indicator {
    filter: invert(1) opacity(0.3);
    cursor: pointer;
  }

  /* === POMODORO === */
  .pomodoro-display {
    text-align: center;
    margin-bottom: 40px;
  }

  .pomo-mode {
    font-size: 11px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--accent2);
    margin-bottom: 16px;
  }

  .pomo-time {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(80px, 18vw, 160px);
    letter-spacing: 4px;
    line-height: 1;
  }

  .pomo-sessions {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: 24px 0;
  }

  .pomo-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    border: 1px solid var(--muted);
    transition: all 0.3s;
  }

  .pomo-dot.filled {
    background: var(--accent2);
    border-color: var(--accent2);
  }

  .pomo-bar-wrap {
    width: 100%;
    max-width: 500px;
    margin: 0 auto 32px;
    height: 3px;
    background: var(--border);
  }

  .pomo-bar {
    height: 100%;
    background: var(--accent2);
    transition: width 1s linear;
    width: 100%;
  }

  /* Alarm ringing overlay */
  .alarm-ring-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 24px;
    animation: flashBg 0.5s ease-in-out infinite alternate;
  }

  @keyframes flashBg {
    from { background: rgba(0,0,0,0.85); }
    to { background: rgba(232,255,71,0.08); }
  }

  .alarm-ring-overlay.show { display: flex; }

  .ring-time {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 100px;
    color: var(--accent);
    letter-spacing: 8px;
  }

  .ring-label {
    font-size: 18px;
    letter-spacing: 4px;
    color: var(--muted);
    text-transform: uppercase;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); }
</style>
</head>
<body>

<header>
  <div class="logo">WEBCLOCK</div>
  <div class="live-indicator"><div class="dot"></div> Live</div>
</header>

<nav>
  <button class="nav-btn active" onclick="switchTab('clock')">Clock</button>
  <button class="nav-btn" onclick="switchTab('stopwatch')">Stopwatch</button>
  <button class="nav-btn" onclick="switchTab('timer')">Timer</button>
  <button class="nav-btn" onclick="switchTab('alarm')">Alarm</button>
  <button class="nav-btn" onclick="switchTab('pomodoro')">Pomodoro</button>

</nav>

<!-- CLOCK -->
<div id="panel-clock" class="panel active">
  <div class="clock-display">
    <div class="big-time">
      <span id="hours">12</span><span class="colon">:</span><span id="minutes">00</span>
    </div>
    <div class="time-meta">
      <span class="seconds-display" id="seconds">00</span>
      <span class="ampm" id="ampm">AM</span>
    </div>
    <div class="date-display" id="date-display"></div>
  </div>
  <div class="analog-container">
    <div class="analog-clock" id="analog-clock">
      <div class="hand hand-hour" id="hand-hour"></div>
      <div class="hand hand-minute" id="hand-minute"></div>
      <div class="hand hand-second" id="hand-second"></div>
    </div>
  </div>
</div>

<!-- STOPWATCH -->
<div id="panel-stopwatch" class="panel">
  <div class="sw-display">
    <div class="sw-time"><span id="sw-h">00</span>:<span id="sw-m">00</span>:<span id="sw-s">00</span></div>
    <div class="sw-ms"><span id="sw-ms">000</span></div>
  </div>
  <div class="btn-row">
    <button class="btn" id="sw-lap-btn" onclick="swLap()" disabled>Lap</button>
    <button class="btn primary" id="sw-start-btn" onclick="swToggle()">Start</button>
    <button class="btn" id="sw-reset-btn" onclick="swReset()">Reset</button>
  </div>
  <div id="sw-laps">
    <table class="laps-table" id="laps-table" style="display:none">
      <thead><tr><th>#</th><th>Lap Time</th><th>Total</th></tr></thead>
      <tbody id="laps-body"></tbody>
    </table>
  </div>
</div>

<!-- TIMER -->
<div id="panel-timer" class="panel">
  <div class="timer-setup" id="timer-setup">
    <div class="time-unit">
      <label>Hours</label>
      <input type="number" id="t-h" value="0" min="0" max="23" placeholder="00">
    </div>
    <span class="time-sep">:</span>
    <div class="time-unit">
      <label>Minutes</label>
      <input type="number" id="t-m" value="5" min="0" max="59" placeholder="00">
    </div>
    <span class="time-sep">:</span>
    <div class="time-unit">
      <label>Seconds</label>
      <input type="number" id="t-s" value="0" min="0" max="59" placeholder="00">
    </div>
  </div>
  <div class="timer-countdown" id="timer-countdown">
    <div class="timer-remaining" id="timer-remaining">00:05:00</div>
    <div class="timer-bar-wrap"><div class="timer-bar" id="timer-bar"></div></div>
  </div>
  <div class="btn-row">
    <button class="btn primary" id="timer-start-btn" onclick="timerToggle()">Start</button>
    <button class="btn" onclick="timerReset()">Reset</button>
  </div>
</div>

<!-- ALARM -->
<div id="panel-alarm" class="panel">
  <div class="alarms-list" id="alarms-list"></div>
  <div class="add-alarm-form">
    <div class="form-group">
      <label>Time</label>
      <input type="time" id="alarm-time-input">
    </div>
    <div class="form-group">
      <label>Label</label>
      <input type="text" id="alarm-label-input" placeholder="Wake up...">
    </div>
    <button class="btn primary" onclick="addAlarm()">Add Alarm</button>
  </div>
</div>

<!-- POMODORO -->
<div id="panel-pomodoro" class="panel">
  <div class="pomodoro-display">
    <div class="pomo-mode" id="pomo-mode">Focus Session</div>
    <div class="pomo-time" id="pomo-time">25:00</div>
    <div class="pomo-sessions" id="pomo-sessions">
      <div class="pomo-dot" id="p0"></div>
      <div class="pomo-dot" id="p1"></div>
      <div class="pomo-dot" id="p2"></div>
      <div class="pomo-dot" id="p3"></div>
    </div>
    <div class="pomo-bar-wrap"><div class="pomo-bar" id="pomo-bar"></div></div>
  </div>
  <div class="btn-row">
    <button class="btn primary" id="pomo-start-btn" onclick="pomoToggle()">Start</button>
    <button class="btn" onclick="pomoReset()">Reset</button>
    <button class="btn" onclick="pomoSkip()">Skip</button>
  </div>
  <div style="text-align:center; margin-top:20px;">
    <div style="font-size:11px; letter-spacing:2px; color:var(--muted); text-transform:uppercase; margin-bottom:16px;">Sessions Completed: <span id="pomo-count">0</span></div>
    <div style="display:flex; justify-content:center; gap:40px;">
      <div style="text-align:center;">
        <div style="font-size:11px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px;">Focus</div>
        <input type="number" id="pomo-focus" value="25" min="1" max="60" style="width:60px; background:var(--surface); border:1px solid var(--border); color:var(--text); font-family:'DM Mono',monospace; font-size:14px; padding:8px; text-align:center; outline:none; border-radius:2px;">
        <div style="font-size:10px; color:var(--muted); margin-top:4px;">min</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:11px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px;">Short Break</div>
        <input type="number" id="pomo-short" value="5" min="1" max="30" style="width:60px; background:var(--surface); border:1px solid var(--border); color:var(--text); font-family:'DM Mono',monospace; font-size:14px; padding:8px; text-align:center; outline:none; border-radius:2px;">
        <div style="font-size:10px; color:var(--muted); margin-top:4px;">min</div>
      </div>
      <div style="text-align:center;">
        <div style="font-size:11px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px;">Long Break</div>
        <input type="number" id="pomo-long" value="15" min="1" max="60" style="width:60px; background:var(--surface); border:1px solid var(--border); color:var(--text); font-family:'DM Mono',monospace; font-size:14px; padding:8px; text-align:center; outline:none; border-radius:2px;">
        <div style="font-size:10px; color:var(--muted); margin-top:4px;">min</div>
      </div>
    </div>
  </div>
</div>

<!-- ALARM RING OVERLAY -->
<div class="alarm-ring-overlay" id="alarm-ring-overlay">
  <div class="ring-time" id="ring-time"></div>
  <div class="ring-label" id="ring-label">Alarm</div>
  <button class="btn primary" onclick="dismissAlarm()">Dismiss</button>
  <button class="btn" onclick="snoozeAlarm()">Snooze 5 min</button>
</div>

<script>
// === TABS ===
function switchTab(tab) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-' + tab).classList.add('active');
  event.target.classList.add('active');
}

// === CLOCK ===
const DAYS = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const MONTHS = ['January','February','March','April','May','June','July','August','September','October','November','December'];

function pad(n) { return String(n).padStart(2,'0'); }

function updateClock() {
  const now = new Date();
  let h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();
  const ampm = h >= 12 ? 'PM' : 'AM';
  const h12 = h % 12 || 12;
  document.getElementById('hours').textContent = pad(h12);
  document.getElementById('minutes').textContent = pad(m);
  document.getElementById('seconds').textContent = pad(s);
  document.getElementById('ampm').textContent = ampm;
  document.getElementById('date-display').textContent =
    `${DAYS[now.getDay()]}  ·  ${MONTHS[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;

  // Analog
  const secDeg = s * 6;
  const minDeg = m * 6 + s * 0.1;
  const hrDeg = (h % 12) * 30 + m * 0.5;
  document.getElementById('hand-hour').style.transform = `translateX(-50%) rotate(${hrDeg}deg)`;
  document.getElementById('hand-minute').style.transform = `translateX(-50%) rotate(${minDeg}deg)`;
  document.getElementById('hand-second').style.transform = `translateX(-50%) rotate(${secDeg}deg)`;
}

setInterval(updateClock, 100);
updateClock();

// === STOPWATCH ===
let swRunning = false, swStart = 0, swElapsed = 0, swInterval = null;
let swLaps = [], swLapStart = 0;

function swToggle() {
  if (!swRunning) {
    swRunning = true;
    swStart = Date.now() - swElapsed;
    swLapStart = swLapStart || swStart;
    swInterval = setInterval(swTick, 10);
    document.getElementById('sw-start-btn').textContent = 'Stop';
    document.getElementById('sw-start-btn').classList.remove('primary');
    document.getElementById('sw-start-btn').classList.add('danger');
    document.getElementById('sw-lap-btn').disabled = false;
  } else {
    swRunning = false;
    clearInterval(swInterval);
    swElapsed = Date.now() - swStart;
    document.getElementById('sw-start-btn').textContent = 'Resume';
    document.getElementById('sw-start-btn').classList.remove('danger');
    document.getElementById('sw-start-btn').classList.add('primary');
  }
}

function swTick() {
  swElapsed = Date.now() - swStart;
  const ms = swElapsed % 1000;
  const total_s = Math.floor(swElapsed / 1000);
  const s = total_s % 60;
  const total_m = Math.floor(total_s / 60);
  const m = total_m % 60;
  const h = Math.floor(total_m / 60);
  document.getElementById('sw-h').textContent = pad(h);
  document.getElementById('sw-m').textContent = pad(m);
  document.getElementById('sw-s').textContent = pad(s);
  document.getElementById('sw-ms').textContent = String(ms).padStart(3,'0');
}

function swLap() {
  if (!swRunning) return;
  const now = Date.now();
  const lapTime = now - swLapStart;
  swLapStart = now;
  swLaps.unshift({ lap: swLaps.length + 1, lapTime, totalTime: swElapsed });
  renderLaps();
}

function renderLaps() {
  const tbody = document.getElementById('laps-body');
  const table = document.getElementById('laps-table');
  table.style.display = 'table';
  tbody.innerHTML = swLaps.map((l, i) => `
    <tr>
      <td>${swLaps.length - i}</td>
      <td>${formatMs(l.lapTime)}</td>
      <td>${formatMs(l.totalTime)}</td>
    </tr>
  `).join('');
}

function formatMs(ms) {
  const total_s = Math.floor(ms / 1000);
  const s = total_s % 60;
  const m = Math.floor(total_s / 60) % 60;
  const h = Math.floor(total_s / 3600);
  const millis = String(ms % 1000).padStart(3,'0');
  return `${pad(h)}:${pad(m)}:${pad(s)}.${millis}`;
}

function swReset() {
  swRunning = false;
  clearInterval(swInterval);
  swElapsed = 0; swStart = 0; swLapStart = 0;
  swLaps = [];
  document.getElementById('sw-h').textContent = '00';
  document.getElementById('sw-m').textContent = '00';
  document.getElementById('sw-s').textContent = '00';
  document.getElementById('sw-ms').textContent = '000';
  document.getElementById('sw-start-btn').textContent = 'Start';
  document.getElementById('sw-start-btn').classList.add('primary');
  document.getElementById('sw-start-btn').classList.remove('danger');
  document.getElementById('sw-lap-btn').disabled = true;
  document.getElementById('laps-body').innerHTML = '';
  document.getElementById('laps-table').style.display = 'none';
}

// === TIMER ===
let timerRunning = false, timerRemaining = 0, timerTotal = 0, timerInterval = null;

function timerToggle() {
  if (!timerRunning) {
    if (timerRemaining <= 0) {
      const h = parseInt(document.getElementById('t-h').value) || 0;
      const m = parseInt(document.getElementById('t-m').value) || 0;
      const s = parseInt(document.getElementById('t-s').value) || 0;
      timerTotal = h*3600 + m*60 + s;
      if (timerTotal <= 0) return;
      timerRemaining = timerTotal;
    }
    timerRunning = true;
    document.getElementById('timer-setup').style.display = 'none';
    document.getElementById('timer-countdown').style.display = 'block';
    document.getElementById('timer-start-btn').textContent = 'Pause';
    timerInterval = setInterval(timerTick, 1000);
    timerRender();
  } else {
    timerRunning = false;
    clearInterval(timerInterval);
    document.getElementById('timer-start-btn').textContent = 'Resume';
  }
}

function timerTick() {
  timerRemaining--;
  if (timerRemaining <= 0) {
    timerRemaining = 0;
    clearInterval(timerInterval);
    timerRunning = false;
    document.getElementById('timer-start-btn').textContent = 'Start';
    timerRender();
    playBeep();
    showNotification('Timer', 'Your timer has finished!');
    return;
  }
  timerRender();
}

function timerRender() {
  const h = Math.floor(timerRemaining / 3600);
  const m = Math.floor((timerRemaining % 3600) / 60);
  const s = timerRemaining % 60;
  document.getElementById('timer-remaining').textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
  const pct = timerTotal > 0 ? (timerRemaining / timerTotal * 100) : 0;
  const bar = document.getElementById('timer-bar');
  bar.style.width = pct + '%';
  bar.classList.toggle('urgent', timerRemaining <= 10);
}

function timerReset() {
  clearInterval(timerInterval);
  timerRunning = false; timerRemaining = 0; timerTotal = 0;
  document.getElementById('timer-setup').style.display = 'flex';
  document.getElementById('timer-countdown').style.display = 'none';
  document.getElementById('timer-start-btn').textContent = 'Start';
  document.getElementById('timer-bar').style.width = '100%';
}

// === ALARM ===
let alarms = [];
let ringingAlarmId = null;

function addAlarm() {
  const time = document.getElementById('alarm-time-input').value;
  const label = document.getElementById('alarm-label-input').value || 'Alarm';
  if (!time) return;
  alarms.push({ id: Date.now(), time, label, enabled: true });
  renderAlarms();
  document.getElementById('alarm-time-input').value = '';
  document.getElementById('alarm-label-input').value = '';
}

function renderAlarms() {
  const list = document.getElementById('alarms-list');
  list.innerHTML = alarms.map(a => `
    <div class="alarm-item" id="alarm-${a.id}">
      <div class="alarm-time-display">${a.time}</div>
      <div class="alarm-label">${a.label}</div>
      <label class="toggle">
        <input type="checkbox" ${a.enabled ? 'checked' : ''} onchange="toggleAlarm(${a.id}, this.checked)">
        <div class="toggle-track"></div>
      </label>
      <button class="alarm-delete" onclick="deleteAlarm(${a.id})">✕</button>
    </div>
  `).join('') || '<div style="color:var(--muted); font-size:13px; letter-spacing:2px; text-align:center; padding:40px;">No alarms set</div>';
}

function toggleAlarm(id, val) {
  const a = alarms.find(x => x.id === id);
  if (a) a.enabled = val;
}

function deleteAlarm(id) {
  alarms = alarms.filter(a => a.id !== id);
  renderAlarms();
}

function checkAlarms() {
  if (ringingAlarmId) return;
  const now = new Date();
  const cur = `${pad(now.getHours())}:${pad(now.getMinutes())}`;
  for (const a of alarms) {
    if (a.enabled && a.time === cur && now.getSeconds() === 0) {
      ringAlarm(a);
      break;
    }
  }
}

function ringAlarm(a) {
  ringingAlarmId = a.id;
  document.getElementById('ring-time').textContent = a.time;
  document.getElementById('ring-label').textContent = a.label;
  document.getElementById('alarm-ring-overlay').classList.add('show');
  playBeep(true);
}

function dismissAlarm() {
  ringingAlarmId = null;
  document.getElementById('alarm-ring-overlay').classList.remove('show');
  stopBeep();
}

function snoozeAlarm() {
  const now = new Date();
  now.setMinutes(now.getMinutes() + 5);
  const snoozeTime = `${pad(now.getHours())}:${pad(now.getMinutes())}`;
  const a = alarms.find(x => x.id === ringingAlarmId);
  if (a) {
    alarms.push({ id: Date.now(), time: snoozeTime, label: a.label + ' (Snooze)', enabled: true });
    renderAlarms();
  }
  dismissAlarm();
}

setInterval(checkAlarms, 1000);
renderAlarms();

// === POMODORO ===
let pomoRunning = false, pomoInterval = null;
let pomoPhase = 'focus'; // focus | short | long
let pomoSessions = 0;
let pomoRemaining = 0, pomoTotal = 0;

function pomoGetDuration(phase) {
  if (phase === 'focus') return (parseInt(document.getElementById('pomo-focus').value) || 25) * 60;
  if (phase === 'short') return (parseInt(document.getElementById('pomo-short').value) || 5) * 60;
  return (parseInt(document.getElementById('pomo-long').value) || 15) * 60;
}

function pomoToggle() {
  if (!pomoRunning) {
    if (pomoRemaining <= 0) {
      pomoTotal = pomoGetDuration(pomoPhase);
      pomoRemaining = pomoTotal;
    }
    pomoRunning = true;
    document.getElementById('pomo-start-btn').textContent = 'Pause';
    pomoInterval = setInterval(pomoTick, 1000);
    pomoRender();
  } else {
    pomoRunning = false;
    clearInterval(pomoInterval);
    document.getElementById('pomo-start-btn').textContent = 'Resume';
  }
}

function pomoTick() {
  pomoRemaining--;
  if (pomoRemaining <= 0) {
    clearInterval(pomoInterval);
    pomoRunning = false;
    playBeep();
    if (pomoPhase === 'focus') {
      pomoSessions++;
      document.getElementById('pomo-count').textContent = pomoSessions;
      pomoPhase = (pomoSessions % 4 === 0) ? 'long' : 'short';
    } else {
      pomoPhase = 'focus';
    }
    pomoTotal = pomoGetDuration(pomoPhase);
    pomoRemaining = pomoTotal;
    document.getElementById('pomo-start-btn').textContent = 'Start';
    pomoRender();
    showNotification('Pomodoro', pomoPhase === 'focus' ? 'Time to focus!' : 'Take a break!');
    return;
  }
  pomoRender();
}

function pomoRender() {
  const m = Math.floor(pomoRemaining / 60);
  const s = pomoRemaining % 60;
  document.getElementById('pomo-time').textContent = `${pad(m)}:${pad(s)}`;
  const phases = { focus: 'Focus Session', short: 'Short Break', long: 'Long Break' };
  document.getElementById('pomo-mode').textContent = phases[pomoPhase];
  const pct = pomoTotal > 0 ? (pomoRemaining / pomoTotal * 100) : 0;
  document.getElementById('pomo-bar').style.width = pct + '%';
  // Dots
  for (let i = 0; i < 4; i++) {
    document.getElementById('p' + i).classList.toggle('filled', i < (pomoSessions % 4));
  }
  // Color
  const color = pomoPhase === 'focus' ? 'var(--accent2)' : 'var(--accent3)';
  document.getElementById('pomo-mode').style.color = color;
  document.getElementById('pomo-bar').style.background = color;
}

function pomoReset() {
  clearInterval(pomoInterval);
  pomoRunning = false; pomoRemaining = 0;
  document.getElementById('pomo-start-btn').textContent = 'Start';
  pomoRender();
}

function pomoSkip() {
  clearInterval(pomoInterval);
  pomoRunning = false;
  if (pomoPhase === 'focus') {
    pomoSessions++;
    document.getElementById('pomo-count').textContent = pomoSessions;
    pomoPhase = (pomoSessions % 4 === 0) ? 'long' : 'short';
  } else {
    pomoPhase = 'focus';
  }
  pomoTotal = pomoGetDuration(pomoPhase);
  pomoRemaining = pomoTotal;
  document.getElementById('pomo-start-btn').textContent = 'Start';
  pomoRender();
}

pomoTotal = pomoGetDuration('focus');
pomoRemaining = pomoTotal;
pomoRender();

// === AUDIO ===
let audioCtx = null, beepOscillator = null, beepInterval = null;

function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

function playBeep(loop = false) {
  try {
    const ctx = getAudioCtx();
    const doBeep = () => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.frequency.value = 880;
      gain.gain.setValueAtTime(0.3, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.5);
    };
    doBeep();
    if (loop) beepInterval = setInterval(doBeep, 1000);
  } catch(e) {}
}

function stopBeep() {
  if (beepInterval) { clearInterval(beepInterval); beepInterval = null; }
}

// === NOTIFICATIONS ===
function showNotification(title, body) {
  if (Notification.permission === 'granted') {
    new Notification(title, { body });
  }
}
if (Notification.permission === 'default') Notification.requestPermission();
</script>
</body>
</html>